<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keats V1: Living Mathematics</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: #000;
            color: #fff;
            font-family: system-ui;
            overflow: hidden;
        }
        
        #canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        .controls {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 40, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 200, 255, 0.3);
            border-radius: 15px;
            padding: 20px;
            width: 300px;
        }
        
        h3 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: #88ccff;
        }
        
        button {
            width: 100%;
            padding: 10px;
            margin: 5px 0;
            background: rgba(100, 200, 255, 0.2);
            border: 1px solid rgba(100, 200, 255, 0.5);
            color: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
        }
        
        button:hover {
            background: rgba(100, 200, 255, 0.4);
        }
        
        label {
            display: block;
            margin: 10px 0;
            font-size: 14px;
        }
        
        input[type="range"] {
            width: 100%;
            margin: 5px 0;
        }
        
        .mode {
            position: fixed;
            top: 20px;
            left: 20px;
            font-size: 48px;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .controls {
                width: calc(100% - 40px);
                right: 20px;
                left: 20px;
            }
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    
    <div class="mode" id="mode">□</div>
    
    <div class="controls">
        <h3>Living Mathematics</h3>
        <label>
            Coherence: <span id="coherence-val">0.5</span>
            <input type="range" id="coherence" min="0" max="1" step="0.01" value="0.5">
        </label>
        <label>
            Complexity: <span id="complexity-val">3</span>
            <input type="range" id="complexity" min="1" max="7" step="1" value="3">
        </label>
        <button onclick="shiftMode()">Shift Modal State</button>
        <button onclick="paradox()">Induce Paradox</button>
    </div>

    <script>
    // IMMEDIATE VISUAL PROOF OF LIFE
    console.log('Starting Keats V1...');
    
    // Global state
    let scene, camera, renderer, geometry;
    let mode = 0;
    const modes = ['□', '◊', '⧫', '※'];
    let coherence = 0.5;
    let complexity = 3;
    
    // Initialize THREE.js
    function init() {
        // Scene
        scene = new THREE.Scene();
        scene.fog = new THREE.Fog(0x000000, 1, 15);
        
        // Camera
        camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.z = 5;
        
        // Renderer
        renderer = new THREE.WebGLRenderer({ 
            canvas: document.getElementById('canvas'),
            antialias: true 
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        
        // Lights
        const light1 = new THREE.PointLight(0xffffff, 1);
        light1.position.set(5, 5, 5);
        scene.add(light1);
        
        const light2 = new THREE.PointLight(0x8888ff, 0.5);
        light2.position.set(-5, -5, 5);
        scene.add(light2);
        
        const ambient = new THREE.AmbientLight(0x222244, 0.3);
        scene.add(ambient);
        
        // Create initial geometry
        createGeometry();
        
        // Start animation
        animate();
        
        // Bind controls
        bindControls();
        
        // Handle resize
        window.addEventListener('resize', onResize);
        
        console.log('V1 initialized successfully!');
    }
    
    // Create the visual geometry
    function createGeometry() {
        // Remove old geometry
        if (geometry) {
            scene.remove(geometry);
            geometry.geometry.dispose();
            geometry.material.dispose();
        }
        
        // Create torus knot based on parameters
        const geo = new THREE.TorusKnotGeometry(
            1 + coherence * 0.5,     // radius
            0.3 + coherence * 0.2,   // tube
            Math.floor(64 + complexity * 16),  // tubular segments
            Math.floor(8 + complexity * 2),    // radial segments
            complexity,              // p
            complexity + 1           // q
        );
        
        // Material with mode-based color
        const hue = mode * 90;
        const mat = new THREE.MeshPhongMaterial({
            color: new THREE.Color(`hsl(${hue}, 80%, 60%)`),
            emissive: new THREE.Color(`hsl(${hue}, 100%, 20%)`),
            specular: 0xffffff,
            shininess: 100,
            wireframe: coherence < 0.3
        });
        
        geometry = new THREE.Mesh(geo, mat);
        scene.add(geometry);
    }
    
    // Animation loop
    function animate() {
        requestAnimationFrame(animate);
        
        if (geometry) {
            // Rotation based on coherence
            geometry.rotation.x += 0.005 + coherence * 0.01;
            geometry.rotation.y += 0.003 + (1 - coherence) * 0.01;
            
            // Subtle pulsing
            const scale = 1 + Math.sin(Date.now() * 0.001) * 0.05;
            geometry.scale.set(scale, scale, scale);
        }
        
        renderer.render(scene, camera);
    }
    
    // Control functions
    function shiftMode() {
        mode = (mode + 1) % modes.length;
        document.getElementById('mode').textContent = modes[mode];
        createGeometry();
    }
    
    function paradox() {
        // Random new state
        coherence = Math.random();
        complexity = Math.floor(Math.random() * 7) + 1;
        
        // Update UI
        document.getElementById('coherence').value = coherence;
        document.getElementById('coherence-val').textContent = coherence.toFixed(2);
        document.getElementById('complexity').value = complexity;
        document.getElementById('complexity-val').textContent = complexity;
        
        // Flash effect
        renderer.setClearColor(0xffffff, 1);
        setTimeout(() => renderer.setClearColor(0x000000, 1), 100);
        
        // Recreate
        createGeometry();
    }
    
    function bindControls() {
        // Coherence
        document.getElementById('coherence').addEventListener('input', (e) => {
            coherence = parseFloat(e.target.value);
            document.getElementById('coherence-val').textContent = coherence.toFixed(2);
            createGeometry();
        });
        
        // Complexity
        document.getElementById('complexity').addEventListener('input', (e) => {
            complexity = parseInt(e.target.value);
            document.getElementById('complexity-val').textContent = complexity;
            createGeometry();
        });
    }
    
    function onResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }
    
    // START IMMEDIATELY
    init();
    </script>
</body>
</html>